<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.javajo.sunshineRoad.mappers.admin.board.AdminInquiryMapper">

	
	<select id="getAllInquiry" resultType="AInquiry">
    SELECT 
    EVENT_ID, S_ID, POST_TYPE_ID,
    EVENT_IMG_ID, SIGUNGU_ID, EVENT_RECRUIT_TYPE_ID,
    EVENT_STATUS_ID, EVENT_STATUS, EVENT_NAME,
    EVENT_CONTENT, EVENT_THUMBNAIL_IMG,
    EVENT_DATE_CREATED, EVENT_RECRUIT_START_DATE,
    EVENT_RECRUIT_END_DATE,
    EVENT_START_DATE, EVENT_END_DATE,
    EVENT_MAX_PEOPLE, EVENT_ADDR,
    EVENT_FAVORITE_CNT, EVENT_VIEW_CNT
    FROM (SELECT 
        SEQ,
        EVENT_ID, S_ID, POST_TYPE_ID,
        EVENT_IMG_ID, SIGUNGU_ID, EVENT_RECRUIT_TYPE_ID,
        EVENT_STATUS_ID, EVENT_STATUS, EVENT_NAME,
        EVENT_CONTENT, EVENT_THUMBNAIL_IMG,
        EVENT_DATE_CREATED, EVENT_RECRUIT_START_DATE,
        EVENT_RECRUIT_END_DATE,
        EVENT_START_DATE, EVENT_END_DATE,
        EVENT_MAX_PEOPLE, EVENT_ADDR,
        EVENT_FAVORITE_CNT, EVENT_VIEW_CNT
        FROM (SELECT
            ROWNUM AS SEQ,
            EVENT_ID, S_ID, POST_TYPE_ID,
            EVENT_IMG_ID, SIGUNGU_ID, EVENT_RECRUIT_TYPE_ID,
            EVENT_STATUS_ID, EVENT_STATUS, EVENT_NAME,
            EVENT_CONTENT, EVENT_THUMBNAIL_IMG,
            EVENT_DATE_CREATED, EVENT_RECRUIT_START_DATE,
            EVENT_RECRUIT_END_DATE,
            EVENT_START_DATE, EVENT_END_DATE,
            EVENT_MAX_PEOPLE, EVENT_ADDR,
            EVENT_FAVORITE_CNT, EVENT_VIEW_CNT
            FROM (SELECT 
                EVENT.EVENT_ID, EVENT.S_ID, EVENT.POST_TYPE_ID,
                EVENT.EVENT_IMG_ID, EVENT.SIGUNGU_ID, RECRUIT_TYPE.EVENT_RECRUIT_TYPE_ID,
                EVENT.EVENT_STATUS_ID, STATUS.EVENT_STATUS, EVENT.EVENT_NAME,
                EVENT.EVENT_CONTENT, EVENT.EVENT_THUMBNAIL_IMG,
                EVENT.EVENT_DATE_CREATED, EVENT.EVENT_RECRUIT_START_DATE,
                EVENT.EVENT_RECRUIT_END_DATE,
                EVENT.EVENT_START_DATE, EVENT.EVENT_END_DATE,
                EVENT.EVENT_MAX_PEOPLE, EVENT.EVENT_ADDR,
                EVENT.EVENT_FAVORITE_CNT, EVENT.EVENT_VIEW_CNT
                FROM EVENT
                    INNER JOIN event_recruitment_type recruit_type ON (event.event_recruit_type_id = recruit_type.event_recruit_type_id)
                    INNER JOIN event_status status ON (event.event_status_id = status.event_status_id)
                WHERE event.event_status_id IN (3, 5)
                ORDER BY event.event_date_created DESC)                     
            )
			WHERE seq <![CDATA[>=]]> #{startPostNo}
		)
		WHERE ROWNUM <![CDATA[<=]]> #{endPostNo}		
	</select>

    <select id="detailInquiry" resultType="AInquiry" parameterType="int">
SELECT INQUIRY_ID, INQUIRY_STATUS_ID, INQUIRY_TYPE_ID,
MEM_ID, INQUIRY_TITLE, INQUIRY_CONTENT, INQUIRY_DATE_CREATED, INQUIRY_A
FROM INQUIRY
AInquiry
    </select>
    
    	
	<select id="selectInquiryStatus" resultType="AInquiry">
 SELECT EVENT_ID, S_ID, POST_TYPE_ID, 
 EVENT_IMG_ID, SIGUNGU_ID, EVENT_RECRUIT_TYPE_ID, 
 EVENT_STATUS_ID, EVENT_NAME, EVENT_CONTENT,
 EVENT_THUMBNAIL_IMG, EVENT_DATE_CREATED, 
 EVENT_RECRUIT_START_DATE, EVENT_RECRUIT_END_DATE, 
 EVENT_START_DATE, EVENT_END_DATE,
 EVENT_MAX_PEOPLE, EVENT_ADDR, 
 EVENT_FAVORITE_CNT, EVENT_VIEW_CNT 
 FROM (SELECT 
    SEQ,
    EVENT_ID, S_ID, POST_TYPE_ID, 
    EVENT_IMG_ID, SIGUNGU_ID, EVENT_RECRUIT_TYPE_ID, 
    EVENT_STATUS_ID, EVENT_NAME, EVENT_CONTENT,
    EVENT_THUMBNAIL_IMG, EVENT_DATE_CREATED, 
    EVENT_RECRUIT_START_DATE, EVENT_RECRUIT_END_DATE, 
    EVENT_START_DATE, EVENT_END_DATE,
    EVENT_MAX_PEOPLE, EVENT_ADDR, 
    EVENT_FAVORITE_CNT, EVENT_VIEW_CNT 
    FROM (SELECT 
        ROWNUM AS SEQ,
        EVENT_ID, S_ID, POST_TYPE_ID, 
        EVENT_IMG_ID, SIGUNGU_ID, EVENT_RECRUIT_TYPE_ID, 
        EVENT_STATUS_ID, EVENT_NAME, EVENT_CONTENT,
        EVENT_THUMBNAIL_IMG, EVENT_DATE_CREATED, 
        EVENT_RECRUIT_START_DATE, EVENT_RECRUIT_END_DATE, 
        EVENT_START_DATE, EVENT_END_DATE,
        EVENT_MAX_PEOPLE, EVENT_ADDR, 
        EVENT_FAVORITE_CNT, EVENT_VIEW_CNT 
        FROM (SELECT 
            EVENT_ID, S_ID, POST_TYPE_ID, 
            EVENT_IMG_ID, SIGUNGU_ID, EVENT_RECRUIT_TYPE_ID, 
            EVENT_STATUS_ID, EVENT_NAME, EVENT_CONTENT,
            EVENT_THUMBNAIL_IMG, EVENT_DATE_CREATED, 
            EVENT_RECRUIT_START_DATE, EVENT_RECRUIT_END_DATE, 
            EVENT_START_DATE, EVENT_END_DATE,
            EVENT_MAX_PEOPLE, EVENT_ADDR, 
            EVENT_FAVORITE_CNT, EVENT_VIEW_CNT 
            FROM  EVENT
            WHERE EVENT_RECRUIT_START_DATE BETWEEN 
            TO_TIMESTAMP(#{searchDTO.startDate}, 'YYYY-MM-DD HH24:MI:SS.xff') 
            AND TO_TIMESTAMP(#{searchDTO.endDate}, 'YYYY-MM-DD HH24:MI:SS.xff'))
           	)
			WHERE seq <![CDATA[>=]]> #{startPostNo}
    	)
    	WHERE ROWNUM <![CDATA[<=]]> #{endPostNo}
	</select>
	
	<select id="selectInquiryTypes" resultType="AInquiry">
 SELECT EVENT_ID, S_ID, POST_TYPE_ID, 
 EVENT_IMG_ID, SIGUNGU_ID, EVENT_RECRUIT_TYPE_ID, 
 EVENT_STATUS_ID, EVENT_NAME, EVENT_CONTENT,
 EVENT_THUMBNAIL_IMG, EVENT_DATE_CREATED, 
 EVENT_RECRUIT_START_DATE, EVENT_RECRUIT_END_DATE, 
 EVENT_START_DATE, EVENT_END_DATE,
 EVENT_MAX_PEOPLE, EVENT_ADDR, 
 EVENT_FAVORITE_CNT, EVENT_VIEW_CNT 
 FROM (SELECT 
    SEQ,
    EVENT_ID, S_ID, POST_TYPE_ID, 
    EVENT_IMG_ID, SIGUNGU_ID, EVENT_RECRUIT_TYPE_ID, 
    EVENT_STATUS_ID, EVENT_NAME, EVENT_CONTENT,
    EVENT_THUMBNAIL_IMG, EVENT_DATE_CREATED, 
    EVENT_RECRUIT_START_DATE, EVENT_RECRUIT_END_DATE, 
    EVENT_START_DATE, EVENT_END_DATE,
    EVENT_MAX_PEOPLE, EVENT_ADDR, 
    EVENT_FAVORITE_CNT, EVENT_VIEW_CNT 
    FROM (SELECT 
        ROWNUM AS SEQ,
        EVENT_ID, S_ID, POST_TYPE_ID, 
        EVENT_IMG_ID, SIGUNGU_ID, EVENT_RECRUIT_TYPE_ID, 
        EVENT_STATUS_ID, EVENT_NAME, EVENT_CONTENT,
        EVENT_THUMBNAIL_IMG, EVENT_DATE_CREATED, 
        EVENT_RECRUIT_START_DATE, EVENT_RECRUIT_END_DATE, 
        EVENT_START_DATE, EVENT_END_DATE,
        EVENT_MAX_PEOPLE, EVENT_ADDR, 
        EVENT_FAVORITE_CNT, EVENT_VIEW_CNT 
        FROM (SELECT 
            EVENT_ID, S_ID, POST_TYPE_ID, 
            EVENT_IMG_ID, SIGUNGU_ID, EVENT_RECRUIT_TYPE_ID, 
            EVENT_STATUS_ID, EVENT_NAME, EVENT_CONTENT,
            EVENT_THUMBNAIL_IMG, EVENT_DATE_CREATED, 
            EVENT_RECRUIT_START_DATE, EVENT_RECRUIT_END_DATE, 
            EVENT_START_DATE, EVENT_END_DATE,
            EVENT_MAX_PEOPLE, EVENT_ADDR, 
            EVENT_FAVORITE_CNT, EVENT_VIEW_CNT 
            FROM  EVENT
            WHERE EVENT_START_DATE BETWEEN 
            TO_TIMESTAMP(#{searchDTO.startDate}, 'YYYY-MM-DD HH24:MI:SS.xff') 
            AND TO_TIMESTAMP(#{searchDTO.endDate}, 'YYYY-MM-DD HH24:MI:SS.xff'))
           	)
			WHERE seq <![CDATA[>=]]> #{startPostNo}
    	)
    	WHERE ROWNUM <![CDATA[<=]]> #{endPostNo}
	</select>


	


    
    <update id="answerInquiry" parameterType="AInquiry">
    UPDATE EVENT SET
    SIGUNGU_ID=#{sigunguId},
    EVENT_RECRUIT_TYPE_ID=#{eventRecruitTypeId},
    EVENT_STATUS_ID=#{eventStatusId},
    EVENT_NAME=#{eventName},
    EVENT_CONTENT=TO_CLOB(#{eventContent}),
    EVENT_RECRUIT_START_DATE = TO_DATE(#{eventRecruitStartDate},'YYYY-MM-DD HH24:MI:SS'),
    EVENT_RECRUIT_END_DATE = TO_DATE(#{eventRecruitEndDate},'YYYY-MM-DD HH24:MI:SS'), 
    EVENT_START_DATE = TO_DATE(#{eventStartDate},'YYYY-MM-DD HH24:MI:SS')
    EVENT_END_DATE = TO_DATE(#{eventEndDate},'YYYY-MM-DD HH24:MI:SS')
    EVENT_MAX_PEOPLE=#{eventMaxPeople},
    EVENT_ADDR=#{eventAddr}
    WHERE EVENT_ID=#{eventId} AND S_ID=#{sId}
    </update>
    


    
    <delete id="deleteInquiryPost" parameterType="int">
    DELETE EVENT WHERE EVENT_ID=#{inquiryId}
    </delete>
    
    

</mapper>